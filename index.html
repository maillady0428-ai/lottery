<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="theme-color" content="#16120b">
<title>LOOSTER GACHA</title>
<style>
  :root{
    --bg:#0b0a08;         /* èƒŒæ™¯ï¼ˆé»’å¯„ã‚Šï¼‰ */
    --card:#14110d;       /* ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ */
    --edge:#2b2319;       /* æ ç·š(æ¿ƒã„é‡‘å±) */
    --gold:#d4af37;       /* ãƒ¡ã‚¤ãƒ³é‡‘è‰² */
    --gold-2:#ffdf6e;     /* æ˜ã‚‹ã„é‡‘ */
    --text:#f7f3e8;       /* æ–‡å­—è‰² */
    --muted:#b7a98a;      /* ã‚µãƒ–æ–‡å­— */
    --accent:#7a5c2b;     /* ãƒœã‚¿ãƒ³ç­‰ã®æ¿ƒé‡‘ */
    --ok:#7CFFB5;         /* ç¥ã‚«ãƒ©ãƒ¼ */
    --warn:#ffd166;       /* æ³¨æ„ã‚«ãƒ©ãƒ¼ */
  }

  /* èƒŒæ™¯ã«é‡‘ç²‰ãƒã‚¤ã‚ºã£ã½ã„è¡¨ç¾ */
  body{
    margin:0; color:var(--text); font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    background:
      radial-gradient(1200px 600px at 80% -20%, rgba(255,223,110,.25), transparent 60%),
      radial-gradient(900px 500px at -10% 120%, rgba(212,175,55,.18), transparent 55%),
      #0b0a08;
  }

  .wrap{min-height:100svh; display:grid; place-items:center; padding:28px;}
  .card{
    width:min(640px,92vw);
    background:linear-gradient(180deg, rgba(255,239,180,.06), rgba(0,0,0,.0)),
               var(--card);
    border-radius:22px;
    padding:26px 22px;
    border:1px solid var(--edge);
    box-shadow:
      0 10px 30px rgba(0,0,0,.5),
      inset 0 1px 0 rgba(255,235,185,.08);
    position:relative;
    overflow:hidden;
  }
  /* ä¸Šéƒ¨ã«ã‚´ãƒ¼ãƒ«ãƒ‰ã®ç´°ã„å…‰ç­‹ */
  .card::before{
    content:""; position:absolute; inset:0;
    background:linear-gradient(90deg, transparent, rgba(212,175,55,.12), transparent);
    height:1px; top:0;
  }

  .brand{display:flex; gap:14px; align-items:center; margin-bottom:12px}
  .logo{
    width:46px; height:46px; border-radius:12px;
    background:conic-gradient(from 20deg, #5a441b, #e0c25a, #7a5c2b, #b7952b, #5a441b);
    box-shadow:inset 0 0 12px rgba(0,0,0,.35), 0 0 8px rgba(212,175,55,.25);
  }
  h1{font-size:24px; letter-spacing:.02em; margin:0}
  .title{
    background:linear-gradient(180deg, var(--gold-2), var(--gold) 70%, #b9962a);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow:0 1px 0 rgba(0,0,0,.35);
  }
  .sub{margin:.35rem 0 1.2rem; color:var(--muted); font-size:14px}

  .panel{
    background:linear-gradient(180deg, rgba(250,235,180,.06), rgba(0,0,0,.0)),
               #100e0b;
    border:1px solid #2a2116; border-radius:16px; padding:18px; margin:12px 0;
  }
  .result{font-size:20px; line-height:1.7}
  .big{font-size:28px; font-weight:800; letter-spacing:.02em}

  .glow{filter:drop-shadow(0 0 18px rgba(212,175,55,.35))}
  .ok{color:var(--ok)}
  .warn{color:var(--warn)}
  .muted{color:var(--muted)}

  .code{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    display:inline-block; margin-top:8px;
    background:#0f0d0a; border:1px dashed #4c3a1e; color:var(--gold-2);
    border-radius:10px; padding:8px 12px;
  }

  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between}
  .btn{
    display:inline-block; cursor:pointer; user-select:none;
    padding:12px 18px; border-radius:12px; font-weight:700; letter-spacing:.02em;
    color:#100e0b;
    background:linear-gradient(180deg, var(--gold-2), var(--gold));
    border:1px solid #b9962a;
    box-shadow:0 6px 16px rgba(212,175,55,.25), inset 0 1px 0 rgba(255,255,255,.35);
  }
  .btn:hover{filter:brightness(1.03)}
  .btn:active{transform:translateY(1px)}

  .hr{height:1px; background:linear-gradient(90deg, transparent, #3a2d18, transparent); margin:18px 0}
  .foot{font-size:12px; color:#c8b98f}
  .how{font-size:13px; color:#d8cba5}

  .spinner{
    width:22px; height:22px; border:3px solid #3e321a; border-top-color:var(--gold-2);
    border-radius:50%; display:inline-block; vertical-align:-5px; margin-right:8px;
    animation:spin .9s linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}

  /* å°ã•ã‚ç«¯æœ«ã§ã®ä½™ç™½èª¿æ•´ */
  @media (max-width:360px){ .result{font-size:18px} .big{font-size:24px} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1 class="title glow">LOOSTER GACHA</h1>
        <div class="sub">NFCã‚¿ãƒƒãƒ or QRã‹ã‚‰å‚åŠ OKã€‚ãƒã‚ºãƒ¬ãªã—ï¼åŒä¸€ç«¯æœ«1æ—¥1å›ã¾ã§ã€‚</div>
      </div>
    </div>

    <div class="panel">
      <div id="status" class="result"><span class="spinner"></span>æŠ½é¸ä¸­ã§ã™â€¦</div>
      <div id="detail" class="how"></div>
    </div>

    <div class="row">
      <button class="btn" id="againBtn" style="display:none">ã‚‚ã†ä¸€åº¦ãƒã‚§ãƒƒã‚¯</button>
      <div class="how">ç”»é¢ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«æç¤ºã—ã¦ãã ã•ã„ã€‚</div>
    </div>

    <div class="hr"></div>
    <div class="foot">
      NFCãŒåå¿œã—ãªã„å ´åˆã¯ã€ãƒ¬ã‚¸ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚é€šä¿¡ä¸èª¿ã®éš›ã¯ã‚¹ã‚¿ãƒƒãƒ•ã¾ã§ã€‚
    </div>
  </div>
</div>

<script>
/* â† ã“ã“ã¯ã‚ãªãŸã®GAS Webã‚¢ãƒ—ãƒªURLï¼ˆåŸ‹ã‚è¾¼ã¿æ¸ˆã¿ï¼‰ */
const GAS = "https://script.google.com/macros/s/AKfycbx2kXtpfhtmof_YWD5FEOJVvN03zdnD4yXNysO32DmNcTkXZSEJknF8Wn2mayqlUFFVgg/exec";

function showResult(data){
  const status = document.getElementById('status');
  const detail = document.getElementById('detail');
  const again  = document.getElementById('againBtn');

  if(data.status === 'already'){
    status.innerHTML = 'ä»Šæ—¥ã¯å‚åŠ æ¸ˆã¿ğŸ—“ï¸ <span class="warn">ã¾ãŸæ˜æ—¥ï¼</span>';
    detail.textContent = 'åŒã˜ç«¯æœ«ã‹ã‚‰ã¯1æ—¥1å›ã¾ã§ã®ã”å‚åŠ ã¨ãªã‚Šã¾ã™ã€‚';
    again.style.display = 'inline-block';
    return;
  }

  if(data.status === 'ok'){
    const map = {
      P1: 'ğŸ‰ <span class="big glow">å¤§å½“ãŸã‚Šï¼1ç­‰</span>',
      P2: 'âœ¨ <span class="big">2ç­‰ å½“ãŸã‚Šï¼</span>',
      P3: 'ğŸ˜Š <span class="big">3ç­‰</span>',
      P4: 'ğŸ‘ <span class="big">4ç­‰</span>',
      P5: 'ğŸ™‚ <span class="big">5ç­‰</span>'
    };
    status.innerHTML = map[data.prize] || (data.label || 'çµæœã‚’è¡¨ç¤ºã§ãã¾ã›ã‚“ã§ã—ãŸ');

    // æ™¯å“ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå¾Œã§è‡ªç”±ã«ç·¨é›†OKï¼‰
    const prizeText = {
      P1: 'ï¼ˆä¾‹ï¼‰ãƒœãƒˆãƒ«åŠé¡åˆ¸',
      P2: 'ï¼ˆä¾‹ï¼‰ãƒ‰ãƒªãƒ³ã‚¯1æ¯ç„¡æ–™',
      P3: 'ï¼ˆä¾‹ï¼‰300å††å¼•ã',
      P4: 'ï¼ˆä¾‹ï¼‰100å††å¼•ã',
      P5: 'ï¼ˆä¾‹ï¼‰å‚åŠ è³'
    }[data.prize] || '';

    const code = data.code ? `<div class="code">ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰ï¼š<b>${data.code}</b></div>` : '';
    detail.innerHTML = `${prizeText}<br>${code}`;

    again.style.display = 'inline-block';
    return;
  }

  status.textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
  detail.textContent = '';
  again.style.display = 'inline-block';
}

async function draw(){
  const status = document.getElementById('status');
  const detail = document.getElementById('detail');
  const again  = document.getElementById('againBtn');

  status.innerHTML = '<span class="spinner"></span>æŠ½é¸ä¸­ã§ã™â€¦';
  detail.textContent = '';
  again.style.display = 'none';

  try{
    const res = await fetch(GAS + '?ua=' + encodeURIComponent(navigator.userAgent), { cache:'no-store' });
    const data = await res.json();
    showResult(data);
  }catch(e){
    status.textContent = 'é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã”ç¢ºèªãã ã•ã„ã€‚';
    detail.textContent = '';
    again.style.display = 'inline-block';
  }
}

document.getElementById('againBtn').addEventListener('click', draw);
draw();
</script>
</body>
</html>
