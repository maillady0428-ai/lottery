<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="theme-color" content="#16120b">
<title>LOOSTER GACHA</title>
<style>
  :root{
    --bg:#0b0a08;         /* 背景（黒寄り） */
    --card:#14110d;       /* カード背景 */
    --edge:#2b2319;       /* 枠線(濃い金属) */
    --gold:#d4af37;       /* メイン金色 */
    --gold-2:#ffdf6e;     /* 明るい金 */
    --text:#f7f3e8;       /* 文字色 */
    --muted:#b7a98a;      /* サブ文字 */
    --accent:#7a5c2b;     /* ボタン等の濃金 */
    --ok:#7CFFB5;         /* 祝カラー */
    --warn:#ffd166;       /* 注意カラー */
  }

  /* 背景に金粉ノイズっぽい表現 */
  body{
    margin:0; color:var(--text); font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    background:
      radial-gradient(1200px 600px at 80% -20%, rgba(255,223,110,.25), transparent 60%),
      radial-gradient(900px 500px at -10% 120%, rgba(212,175,55,.18), transparent 55%),
      #0b0a08;
  }

  .wrap{min-height:100svh; display:grid; place-items:center; padding:28px;}
  .card{
    width:min(640px,92vw);
    background:linear-gradient(180deg, rgba(255,239,180,.06), rgba(0,0,0,.0)),
               var(--card);
    border-radius:22px;
    padding:26px 22px;
    border:1px solid var(--edge);
    box-shadow:
      0 10px 30px rgba(0,0,0,.5),
      inset 0 1px 0 rgba(255,235,185,.08);
    position:relative;
    overflow:hidden;
  }
  /* 上部にゴールドの細い光筋 */
  .card::before{
    content:""; position:absolute; inset:0;
    background:linear-gradient(90deg, transparent, rgba(212,175,55,.12), transparent);
    height:1px; top:0;
  }

  .brand{display:flex; gap:14px; align-items:center; margin-bottom:12px}
  .logo{
    width:46px; height:46px; border-radius:12px;
    background:conic-gradient(from 20deg, #5a441b, #e0c25a, #7a5c2b, #b7952b, #5a441b);
    box-shadow:inset 0 0 12px rgba(0,0,0,.35), 0 0 8px rgba(212,175,55,.25);
  }
  h1{font-size:24px; letter-spacing:.02em; margin:0}
  .title{
    background:linear-gradient(180deg, var(--gold-2), var(--gold) 70%, #b9962a);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow:0 1px 0 rgba(0,0,0,.35);
  }
  .sub{margin:.35rem 0 1.2rem; color:var(--muted); font-size:14px}

  .panel{
    background:linear-gradient(180deg, rgba(250,235,180,.06), rgba(0,0,0,.0)),
               #100e0b;
    border:1px solid #2a2116; border-radius:16px; padding:18px; margin:12px 0;
  }
  .result{font-size:20px; line-height:1.7}
  .big{font-size:28px; font-weight:800; letter-spacing:.02em}

  .glow{filter:drop-shadow(0 0 18px rgba(212,175,55,.35))}
  .ok{color:var(--ok)}
  .warn{color:var(--warn)}
  .muted{color:var(--muted)}

  .code{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    display:inline-block; margin-top:8px;
    background:#0f0d0a; border:1px dashed #4c3a1e; color:var(--gold-2);
    border-radius:10px; padding:8px 12px;
  }

  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between}
  .btn{
    display:inline-block; cursor:pointer; user-select:none;
    padding:12px 18px; border-radius:12px; font-weight:700; letter-spacing:.02em;
    color:#100e0b;
    background:linear-gradient(180deg, var(--gold-2), var(--gold));
    border:1px solid #b9962a;
    box-shadow:0 6px 16px rgba(212,175,55,.25), inset 0 1px 0 rgba(255,255,255,.35);
  }
  .btn:hover{filter:brightness(1.03)}
  .btn:active{transform:translateY(1px)}

  .hr{height:1px; background:linear-gradient(90deg, transparent, #3a2d18, transparent); margin:18px 0}
  .foot{font-size:12px; color:#c8b98f}
  .how{font-size:13px; color:#d8cba5}

  .spinner{
    width:22px; height:22px; border:3px solid #3e321a; border-top-color:var(--gold-2);
    border-radius:50%; display:inline-block; vertical-align:-5px; margin-right:8px;
    animation:spin .9s linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}

  /* 小さめ端末での余白調整 */
  @media (max-width:360px){ .result{font-size:18px} .big{font-size:24px} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1 class="title glow">LOOSTER GACHA</h1>
        <div class="sub">NFCタッチ or QRから参加OK。ハズレなし／同一端末1日1回まで。</div>
      </div>
    </div>

    <div class="panel">
      <div id="status" class="result"><span class="spinner"></span>抽選中です…</div>
      <div id="detail" class="how"></div>
    </div>

    <div class="row">
      <button class="btn" id="againBtn" style="display:none">もう一度チェック</button>
      <div class="how">画面のコードをスタッフに提示してください。</div>
    </div>

    <div class="hr"></div>
    <div class="foot">
      NFCが反応しない場合は、レジのQRコードをご利用ください。通信不調の際はスタッフまで。
    </div>
  </div>
</div>

<script>
/* ← ここはあなたのGAS WebアプリURL（埋め込み済み） */
const GAS = "https://script.google.com/macros/s/AKfycbx2kXtpfhtmof_YWD5FEOJVvN03zdnD4yXNysO32DmNcTkXZSEJknF8Wn2mayqlUFFVgg/exec";

function showResult(data){
  const status = document.getElementById('status');
  const detail = document.getElementById('detail');
  const again  = document.getElementById('againBtn');

  if(data.status === 'already'){
    status.innerHTML = '今日は参加済み🗓️ <span class="warn">また明日！</span>';
    detail.textContent = '同じ端末からは1日1回までのご参加となります。';
    again.style.display = 'inline-block';
    return;
  }

  if(data.status === 'ok'){
    const map = {
      P1: '🎉 <span class="big glow">大当たり！1等</span>',
      P2: '✨ <span class="big">2等 当たり！</span>',
      P3: '😊 <span class="big">3等</span>',
      P4: '👍 <span class="big">4等</span>',
      P5: '🙂 <span class="big">5等</span>'
    };
    status.innerHTML = map[data.prize] || (data.label || '結果を表示できませんでした');

    // 景品テキスト（後で自由に編集OK）
    const prizeText = {
      P1: '（例）ボトル半額券',
      P2: '（例）ドリンク1杯無料',
      P3: '（例）300円引き',
      P4: '（例）100円引き',
      P5: '（例）参加賞'
    }[data.prize] || '';

    const code = data.code ? `<div class="code">クーポンコード：<b>${data.code}</b></div>` : '';
    detail.innerHTML = `${prizeText}<br>${code}`;

    again.style.display = 'inline-block';
    return;
  }

  status.textContent = 'エラーが発生しました。時間をおいて再度お試しください。';
  detail.textContent = '';
  again.style.display = 'inline-block';
}

async function draw(){
  const status = document.getElementById('status');
  const detail = document.getElementById('detail');
  const again  = document.getElementById('againBtn');

  status.innerHTML = '<span class="spinner"></span>抽選中です…';
  detail.textContent = '';
  again.style.display = 'none';

  try{
    const res = await fetch(GAS + '?ua=' + encodeURIComponent(navigator.userAgent), { cache:'no-store' });
    const data = await res.json();
    showResult(data);
  }catch(e){
    status.textContent = '通信に失敗しました。ネットワークをご確認ください。';
    detail.textContent = '';
    again.style.display = 'inline-block';
  }
}

document.getElementById('againBtn').addEventListener('click', draw);
draw();
</script>
</body>
</html>
